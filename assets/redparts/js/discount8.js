$(function(){if($("#AH_PurchaseListPopUpTmpl").length){IB.views.PurchaseListPopup=IB.views.BaseView.extend({template:_.template($("#AH_PurchaseListPopUpTmpl").html()),initialize:function(){this.addedProductList=[];this.purchaseListAdded=false;this.getPurchaseList();},events:{'click #AH_AddPurchaseName':'addPurchaseItem','click #AH_CreatePurchaseName':'createPurchaseItem','click .AH_ClosePopUp':'closePopUp',},addPurchaseItem:function(e){var purchaseListName=this.$('.AH_AddedPurchaseList').val();if(!purchaseListName){this.$('.AH_PurchaseListName_Error').removeClass('hide');return;}
this.$('.AH_PurchaseListName_Error').addClass('hide');this.savePurchaseList(purchaseListName);IB.GA&&ga("send","event","Pdp_purchaseList","Click","Add_to_purchaseListPdp");},createPurchaseItem:function(e){var newPurchaseListName=this.$('.AH_NewListName').val();if(!newPurchaseListName){this.$('.AH_NewPurchaseListName_Error').removeClass('hide');return;}
this.$('.AH_NewPurchaseListName_Error').addClass('hide');this.savePurchaseList(newPurchaseListName);IB.GA&&ga("send","event","Pdp_purchaseList","Click","Add_to_newPurchaseList");},savePurchaseList:function(purchaseName){this.$('.AH_Server_Error').text('').addClass('hide');var that=this;$.ajax({url:"/createpurchaselist/",type:"GET",data:{name:purchaseName,sku:this.sku,},success:function(res){var result=res;if(result['error']){that.$('.AH_Server_Error').text(result['error']).removeClass('hide');}else if(result['sku']){that.purchaseListAdded=true;that.render();}}});},serialize:function(){return{addedProductList:this.addedProductList,purchaseListAdded:this.purchaseListAdded,};},getPurchaseList:function(e){var self=this
$.ajax({url:"/getpurchaselist/",success:function(res){if(res&&!res.error){self.addedProductList=_.keys(res);}
self.render();}});},closePopUp:function(){this.removeView();this.remove();},});}});function addToPurchaseList(e){e.preventDefault()
var sku=$(e.currentTarget).data('sku');var qty=$(e.currentTarget).data('qty');listpagebuynow('',sku,qty);}